(("undefined"!==typeof self?self:this).webpackJsonp=("undefined"!==typeof self?self:this).webpackJsonp||[]).push([[93],{"/I4d":function(e,t,r){"use strict";(function(e){function n(e){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.useGetAllPendingFetchableResources=t.useFetchableResourceFetch=t.useGetResource=t.useFetchableResource=t.FetchableResourceProvider=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!==typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(i,a,s):i[a]=e[a]}i.default=e,r&&r.set(e,i);return i}(r("FyRH")),o=r("5McB"),a=r("QNIz"),s=r("Q0yx"),c=r("IiRn");function u(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(c){s=!0,i=c}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var m=(0,s.apiCamelizeMiddleware)((0,o.createFetch)(_(_({},o.defaultFetchConfig),{},{credentials:"include"}))),h=(0,i.createContext)(void 0),b=(0,i.memo)((function(e){var t=e.fetch,r=e.cleanupAfterMs,n=e.prefetchedData,o=void 0===n?{}:n,s=e.children,u=null!==t&&void 0!==t?t:m,f=l((0,i.useState)({}),1)[0];(0,i.useEffect)((function(){for(var e in o)f[e]||(f[e]=new c.FetchableResource({fetch:u,url:e,cleanupAfterMs:r,initialData:o[e]})),delete o[e]}),[u,f,o,r]);var d=(0,i.useRef)(!0);(0,i.useEffect)((function(){d.current?d.current=!1:console.warn(a.CONSOLE_PREFIX,a.CONSOLE_STYLE,"Fetch resource prop change not applied to existing resources.")}),[r]);var _=(0,i.useCallback)((function(e){var t;return f[e]=null!==(t=f[e])&&void 0!==t?t:new c.FetchableResource({fetch:u,url:e,cleanupAfterMs:r,initialData:o[e]})}),[u,r,f,o]),p=(0,i.useCallback)((function(){return Object.values(f).filter((function(e){return void 0===e.data&&e.isFetching}))}),[f]),b=(0,i.useMemo)((function(){return{fetch:u,getResource:_,getAllPendingResources:p}}),[u,_,p]);return i.default.createElement(h.Provider,{value:b},s)}));t.FetchableResourceProvider=b;t.useFetchableResource=function(e){var t=(0,i.useContext)(h);if(!t)throw new Error("Attempted to use useFetchableResource without a provider. Please add a provider to your component tree");return t.getResource(e)};t.useGetResource=function(){var e=(0,i.useContext)(h);if(!e)throw new Error("Attempted to use useGetResource without a provider. Please add a provider to your component tree");return e.getResource};t.useFetchableResourceFetch=function(){var e=(0,i.useContext)(h);if(!e)throw new Error("Attempted to use useFetchableResourceFetch without a provider. Please add a FetchableResourceProvider to your component tree");return e.fetch};t.useGetAllPendingFetchableResources=function(){var t,r=(0,i.useContext)(h);return r||"enabled"!==e.env.DETAILED_ERRORS||console.warn("Get all pending fetchable resources called with no provider"),null!==(t=null===r||void 0===r?void 0:r.getAllPendingResources)&&void 0!==t?t:function(){return[]}}}).call(this,r("5IsQ"))},"1k3P":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiCamelize=t.camelizeJsonPatchPath=void 0;var n=r("AD/F");t.camelizeJsonPatchPath=function(e){return/[A-Za-z]+_[A-Za-z0-9_]*/.test(e)||function(e){return/[A-Z]+[A-Za-z]*/.test(e)}(e)?(0,n.camelize)(e):e};t.apiCamelize=function(e){return(0,n.camelizeKeys)(e,(function(e,t,r){var n=function(e){return/^[A-Za-z]+_[A-Za-z0-9_]*$/.test(e)}(e)||function(e){return/^[A-Z]+[A-Za-z]*$/.test(e)}(e);return n?t(e,r):e}))}},"7UT7":function(e,t,r){"use strict";function n(e){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.StreamingResource=t.METRIC_NAMES=t.ConnectionTimeoutError=t.__testOnlyDisableTextStreamRnHack=t.enableTextStreamRnHack=t.DEFAULT_HEARTBEAT_STALE_TIMEOUT=t.DEFAULT_HEARTBEAT_RECONNECT_TIMEOUT=void 0;var i,o=r("5McB"),a=(i=r("OoM2"))&&i.__esModule?i:{default:i},s=r("F2mt"),c=r("Jq+A"),u=r("QZlR"),l=r("QHVe"),f=r("qhgI"),d=r("1k3P"),_=r("QNIz"),p=r("l+no");function m(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){return y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},y(e,t)}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=E(e);if(t){var i=E(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return S(this,r)}}function S(e,t){if(t&&("object"===n(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},E(e)}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var M=1e3;t.DEFAULT_HEARTBEAT_RECONNECT_TIMEOUT=16e3;t.DEFAULT_HEARTBEAT_STALE_TIMEOUT=2e4;var w=!1;t.enableTextStreamRnHack=function(){w=!0};t.__testOnlyDisableTextStreamRnHack=function(){w=!1};var C=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(r,e);var t=g(r);function r(){var e;v(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return O(T(e=t.call.apply(t,[this].concat(i))),"name","ConnectionTimeoutError"),Object.setPrototypeOf(T(e),r.prototype),e}return r}(c.NetworkError);t.ConnectionTimeoutError=C;var N={TIME_TO_ESTABLISH_CONNECTION:"sse_time_to_establish_connection",CONNECTION_OPEN:"sse_connection_open",TIME_TO_FIRST_SNAPSHOT:"sse_time_to_first_snapshot",CONTENT_LENGTH:"sse_content_length",CONNECTION_CLOSED:"sse_connection_closed",CONNECTION_ERROR:"sse_connection_error",STREAM_DONE:"sse_stream_done",STALE_DATA:"sse_stale_data"};t.METRIC_NAMES=N;var A=function(){function e(t){var r=this,n=t.url,i=t.streamName,h=t.fetch,b=t.closeUnusedConnectionAfterMs,y=void 0===b?500:b,g=t.pauseAfterNotVisibleForMs,S=void 0===g?6e4:g,T=t.maxMissingHeartbeatIntervalMs,E=void 0===T?16e3:T,A=t.markAsStaleAfterMs,P=void 0===A?2e4:A,R=t.maxConnectionTimeoutMs,I=void 0===R?1e4:R;if(v(this,e),O(this,"_subscribers",new Set),O(this,"_noSubscribersTimestamp",Date.now()),O(this,"_pageVisible",!0),O(this,"_createdAt",Date.now()),O(this,"_streamProcessor",void 0),O(this,"_deferredLoad",new p.DeferredPromise),O(this,"_notVisibleTimestamp",(0,l.getIsVisible)()?void 0:Date.now()),O(this,"_streamProcessorCreatedTimes",0),O(this,"_currentSnapshot",void 0),O(this,"_missingHeartbeatReconnectTimeout",void 0),O(this,"_missingHeartbeatSetStaleTimeout",void 0),O(this,"_cleanupTimeout",void 0),O(this,"_stopWatchingPageVisibility",void 0),O(this,"_startWatchingPageVisibility",(function(){if(!r._stopWatchingPageVisibility){var e=(0,l.onVisibleChanged)((function(e){var t;e?(r._pageVisible=!0,r._notVisibleTimestamp=void 0,r._open()):(r._pageVisible=!1,r._notVisibleTimestamp=null!==(t=r._notVisibleTimestamp)&&void 0!==t?t:Date.now(),r._subscribers.size&&console.debug(_.CONSOLE_PREFIX,_.CONSOLE_STYLE,"Reopening the SSE connection",r.url),r._scheduleCleanup())}));r._stopWatchingPageVisibility=e}})),O(this,"_handleSnapshotMessage",(function(e){var t=(0,d.apiCamelize)(e);(0,a.default)(r._data,t)||(r._data=t,r._currentSnapshot=void 0,r._notifySubscribers({eventType:"snapshot",data:t})),r._lastUpdated=Date.now(),r._deferredLoad.resolve()})),O(this,"_handlePatchMessage",(function(e){if(e.length)try{var t;if(!r._data)throw new Error("Received a patch without a current snapshot (".concat(r.url,")"));var n,i=m(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;"add"!==o.op&&"replace"!==o.op||(o.value=(0,d.apiCamelize)(o.value)),o.path=(0,d.camelizeJsonPatchPath)(o.path)}}catch(l){i.e(l)}finally{i.f()}(0,s.applyPatch)(r._data,e,!0);var c=r._currentSnapshot instanceof Error||null===(t=r._currentSnapshot)||void 0===t?void 0:t.data,u=r._data instanceof Error?void 0:r._data;r._lastUpdated=Date.now(),(0,a.default)(r._data,c)||(r._currentSnapshot=void 0,r._notifySubscribers({eventType:"patch",data:u,patches:e}))}catch(_){(0,f.reportError)({error:_,metadata:{url:r.url}})}})),O(this,"_handleHeartbeat",(function(){r._lastHeartbeatTimestamp=Date.now()})),O(this,"_handleMessage",(function(){r._lastMessageTimestamp=Date.now(),r._checkMissingHeartbeat(),r._scheduleHeartbeatReconnectCheck()})),O(this,"_handleError",(function(e,t){(0,f.reportError)({error:e,metadata:{url:r.url,errorSource:t}}),e instanceof C||(r._data=e,r._handleConnectionErrorMetric(e,t)),e instanceof c.NetworkError&&r._pageVisible&&r._reconnect()})),O(this,"_handleConnectionOpenMetric",(function(e){var t,n,i,o=r.streamName,a=Date.now()-e,s=null!==(t=null===(n=navigator)||void 0===n||null===(i=n.connection)||void 0===i?void 0:i.effectiveType)&&void 0!==t?t:"undefined";(0,u.logMetric)({metricName:N.TIME_TO_ESTABLISH_CONNECTION,metricType:u.MetricType.distribution,value:a,tags:{fetch_based:"fetch_based",stream_name:o}}),(0,u.logMetric)({metricName:N.CONNECTION_OPEN,metricType:u.MetricType.count,value:1,tags:{fetch_based:"fetch_based",stream_name:o,connection_type:s}})})),O(this,"_handleFirstSnapshotMetric",(function(e,t){var n=r.streamName;if(r.isAppVisible){var i=Date.now()-t;(0,u.logMetric)({metricName:N.TIME_TO_FIRST_SNAPSHOT,metricType:u.MetricType.distribution,value:i,tags:{fetch_based:"fetch_based",stream_name:n}}),(0,u.logMetric)({metricName:N.CONTENT_LENGTH,metricType:u.MetricType.distribution,value:e,tags:{fetch_based:"fetch_based",stream_name:n,stream_message_type:"snapshot"}})}})),O(this,"_handleMessageMetric",(function(e,t){var n=Date.now(),i=r._lastSentMetricTimestamp,o=r.streamName;!r.isAppVisible||i&&n-i<1e3||(r._lastSentMetricTimestamp=Date.now(),(0,u.logMetric)({metricName:N.CONTENT_LENGTH,metricType:u.MetricType.distribution,value:t,tags:{fetch_based:"fetch_based",stream_name:o,stream_message_type:e}}))})),O(this,"_handleDoneMetric",(function(e){var t=r.streamName;(0,u.logMetric)({metricName:N.STREAM_DONE,metricType:u.MetricType.count,value:1,tags:{fetch_based:"fetch_based",stream_name:t,reconnected:e?"true":"false"}})})),O(this,"_handleConnectionCloseMetric",(function(e){var t,n,i,o=null!==(t=null===(n=navigator)||void 0===n||null===(i=n.connection)||void 0===i?void 0:i.effectiveType)&&void 0!==t?t:"undefined";(0,u.logMetric)({metricName:N.CONNECTION_CLOSED,metricType:u.MetricType.count,value:1,tags:{fetch_based:"fetch_based",stream_name:r.streamName,stream_closing_reason:e,connection_type:o}})})),O(this,"_getIsOnlineMetricValue",(function(){var e=(0,l.getIsOnline)();return void 0===e?"n/a":e?"true":"false"})),O(this,"_handleConnectionErrorMetric",(function(e,t){(0,u.logMetric)({metricName:N.CONNECTION_ERROR,metricType:u.MetricType.count,value:1,tags:{fetch_based:"fetch_based",stream_name:r.streamName,is_online:r._getIsOnlineMetricValue(),errorSource:t,status:e instanceof o.ApiError?String(e.status):e instanceof C?"timeout_error":"network_error"}})})),O(this,"_reconnect",(function(){r._cleanupStreamProcessor(),r._open()})),O(this,"_open",(async function(){if(await(0,l.delayUntilNetworkConnection)(),!r._streamProcessor){var e=Date.now();r._streamProcessor=new o.SseStreamProcessor({onResult:function(t,n){r._handleMessage(),"snapshot"in t.result?(!r._data&&r.isAppVisible?r._handleFirstSnapshotMetric(n.length,e):r._handleMessageMetric("snapshot",n.length),r._handleSnapshotMessage(t.result.snapshot)):"patch"in t.result?(r._handlePatchMessage(t.result.patch.operations),r._handleMessageMetric("patch",n.length)):t.result.heartbeat&&r._handleHeartbeat()},onError:function(e){r._handleError(e,"read")},onDone:function(){var e=Boolean(r._pageVisible&&r._subscribers.size);console.debug(_.CONSOLE_PREFIX,_.CONSOLE_STYLE,"Stream is done",{url:r.url,reconnected:e}),r._handleDoneMetric(e),e&&r._reconnect()}}),r._streamProcessorCreatedTimes+=1;var t,n,i=new AbortController,a=!1,s=await Promise.race([r._fetch(r.url,{signal:i.signal,credentials:"include",headers:{"Content-Type":w?"text":"text/event-stream"}}),(t=function(){return a||i.abort(),new C({message:"Connection timeout reached for url: ".concat(r.url,".")})},n=r._maxConnectionTimeoutMs,new Promise((function(e){return setTimeout((function(){e(t())}),n)})))]);if(a=!0,s instanceof Error){var u=s;r._handleError(u,"open")}else if(null!=s.body){if(r._streamProcessor){console.debug(_.CONSOLE_PREFIX,_.CONSOLE_STYLE,"Streaming resource opened.",r.url),r._handleConnectionOpenMetric(e);var f=s.body.getReader();r._streamProcessor.start(f),r._scheduleIsStaleCheck(),r._scheduleHeartbeatReconnectCheck()}}else{var d=new c.NetworkError({message:"Response body was null"});r._handleError(d,"open")}}})),O(this,"_scheduleCleanup",(function(){if(r._cleanupTimeout&&clearTimeout(r._cleanupTimeout),r._streamProcessor){var e=Date.now(),t=r._noSubscribersTimestamp?e-r._noSubscribersTimestamp:void 0,n=r._notVisibleTimestamp?e-r._notVisibleTimestamp:void 0;if("undefined"!==typeof t||"undefined"!==typeof n){var i=Math.min("undefined"!==typeof t?r._closeUnusedConnectionAfterMs-t:Number.MAX_SAFE_INTEGER,"undefined"!==typeof n?r._pauseAfterNotVisibleForMs-n:Number.MAX_SAFE_INTEGER);if(i>0)return console.debug(_.CONSOLE_PREFIX,_.CONSOLE_STYLE,"Streaming connection shutdown scheduled",{url:r.url,shutdownIn:i,reason:"undefined"!==typeof n?"App is not visible":"No active subscribers"}),void(r._cleanupTimeout=setTimeout(r._scheduleCleanup,i+1));"undefined"!==typeof n&&(console.debug(_.CONSOLE_PREFIX,_.CONSOLE_STYLE,"Closing streaming connection because the app is not visible.",{url:r.url}),r._handleConnectionCloseMetric("app_not_visible")),"undefined"!==typeof t&&(console.debug(_.CONSOLE_PREFIX,_.CONSOLE_STYLE,"Closing streaming connection because there are no active subscribers.",{url:r.url}),r._handleConnectionCloseMetric("no_subscribers")),r._cleanupStreamProcessor()}}})),O(this,"_scheduleIsStaleCheck",(function(){r._missingHeartbeatSetStaleTimeout&&clearTimeout(r._missingHeartbeatSetStaleTimeout),r._missingHeartbeatSetStaleTimeout=setTimeout((function(){r._checkMissingHeartbeat()}),r._markAsStaleAfterMs)})),O(this,"_scheduleHeartbeatReconnectCheck",(function(){r._missingHeartbeatReconnectTimeout&&clearTimeout(r._missingHeartbeatReconnectTimeout),r._missingHeartbeatReconnectTimeout=setTimeout((function(){r._pageVisible&&r._reconnect()}),r._maxMissingHeartbeatIntervalMs)})),O(this,"load",(function(){r._open();return async function(){await r._deferredLoad,0===r.numSubscribers&&(r._noSubscribersTimestamp=Date.now(),r._scheduleCleanup())}(),r._deferredLoad})),O(this,"waitForUpdate",(function(){return r._open(),r._updateDeferred||(r._updateDeferred=new p.DeferredPromise),r._updateDeferred})),O(this,"_resolveUpdatePromise",(function(){r._updateDeferred&&(r._updateDeferred.resolve(),r._updateDeferred=void 0)})),O(this,"_eventIsUpdate",(function(e){return"stale"===e.eventType?!e.isStale:"error"!==e.eventType})),O(this,"_notifySubscribers",(function(e){var t,n=m(r._subscribers);try{for(n.s();!(t=n.n()).done;){var i=t.value;try{i.callback(e)}catch(o){(0,f.reportError)({error:o,metadata:{url:r.url}})}}}catch(a){n.e(a)}finally{n.f()}r._eventIsUpdate(e)&&r._resolveUpdatePromise()})),O(this,"_checkMissingHeartbeat",(function(){var e,t=null!==(e=r._lastMessageTimestamp)&&void 0!==e?e:0,n=Date.now(),i=n-t>r._markAsStaleAfterMs,o=r.streamName;i!==r._isStale&&(r._isStale=i,r._isStale?(console.debug(_.CONSOLE_PREFIX,_.CONSOLE_STYLE,o,": Stale data","no heartbeats or other messages seens for",(n-t)/M,"seconds"),r.isAppVisible&&(0,u.logMetric)({metricName:N.STALE_DATA,metricType:u.MetricType.distribution,value:1,tags:{fetch_based:"fetch_based",stream_name:o}})):console.debug(_.CONSOLE_PREFIX,_.CONSOLE_STYLE,o,": Stale data recovered"),r._notifySubscribers({eventType:"stale",isStale:i})),r._isStale||r._scheduleIsStaleCheck()})),O(this,"subscribe",(function(e){return r._subscribers.add(e),r._startWatchingPageVisibility(),r._noSubscribersTimestamp=void 0,r._open(),function(){var t;(r._subscribers.delete(e),0===r._subscribers.size)&&(r._noSubscribersTimestamp=Date.now(),null===(t=r._stopWatchingPageVisibility)||void 0===t||t.call(r));0===r.numSubscribers&&(r._noSubscribersTimestamp=Date.now(),r._scheduleCleanup())}})),this.url=n,this.streamName=i,this._fetch=h,y&&y<0)throw new Error("closeUnusedConnectionAfter after MS must be greater than 0");if(S&&S<0)throw new Error("pauseAfterNotVisibleForMs must be greater than 0");this._createdAt=Date.now(),this._maxMissingHeartbeatIntervalMs=E,this._closeUnusedConnectionAfterMs=y,this._pauseAfterNotVisibleForMs=S,this._markAsStaleAfterMs=P,this._maxConnectionTimeoutMs=I,this._isStale=!1}var t,r,n;return t=e,(r=[{key:"data",get:function(){return this._data}},{key:"lastUpdated",get:function(){return this._lastUpdated}},{key:"numSubscribers",get:function(){return this._subscribers.size}},{key:"dataSnapshot",get:function(){var e=this._data,t=this._lastUpdated;if(e)return this._currentSnapshot||(this._currentSnapshot=e instanceof Error?e:{data:(0,s.deepClone)(e),lastUpdated:null!==t&&void 0!==t?t:Date.now()}),this._currentSnapshot}},{key:"lastHeartbeatTimestamp",get:function(){return this._lastHeartbeatTimestamp}},{key:"isLoading",get:function(){return(!this.data||this._isStale)&&Boolean(this._streamProcessor)}},{key:"isAppVisible",get:function(){return"undefined"===typeof this._notVisibleTimestamp}},{key:"_cleanupStreamProcessor",value:function(){var e;null===(e=this._streamProcessor)||void 0===e||e.cancel(),this._streamProcessor=void 0,this._missingHeartbeatReconnectTimeout&&clearTimeout(this._missingHeartbeatReconnectTimeout)}}])&&b(t.prototype,r),n&&b(t,n),e}();t.StreamingResource=A},"8TRC":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ApiError",{enumerable:!0,get:function(){return n.ApiError}});var n=r("5McB")},"8jXO":function(e,t,r){"use strict";function n(e){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.useGetAllPendingStreamingResources=t.useStreamingResource=t.StreamingResourceProvider=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!==typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(i,a,s):i[a]=e[a]}i.default=e,r&&r.set(e,i);return i}(r("FyRH")),o=r("5McB"),a=r("QNIz"),s=r("It2l"),c=r("7UT7");function u(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(c){s=!0,i=c}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"===typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var h=(0,o.createFetch)(p(p({},o.defaultFetchConfig),{},{credentials:"include"})),b=(0,i.createContext)(void 0),v=(0,i.memo)((function(e){var t=e.fetch,r=e.closeUnusedConnectionAfterMs,n=e.pauseAfterNotVisibleForMs,o=e.maxMissingHeartbeatIntervalMs,u=e.initialResources,d=e.children,_=e.enableFetchBasedStreaming,p=e.checkAllowFetchBasedStreamingByUrl,m=null!==t&&void 0!==t?t:h,v=l((0,i.useState)((function(){var e={};if(u){var t,r=function(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=f(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(u);try{for(r.s();!(t=r.n()).done;){var n=t.value;e[n.url]=n}}catch(i){r.e(i)}finally{r.f()}}return e})),1)[0],y=(0,i.useRef)(!0);(0,i.useEffect)((function(){y.current?y.current=!1:console.warn(a.CONSOLE_PREFIX,a.CONSOLE_STYLE,"Streaming resource prop change not applied to existing resources.")}),[r,n,o,u]);var g=(0,i.useCallback)((function(e){var t=e.url,i=e.streamName,a=!p||p(t),u=_&&a?c.StreamingResource:s.LegacyStreamingResource;if(v[t])return v[t];var l=new u({fetch:m,url:t,streamName:i,closeUnusedConnectionAfterMs:r,pauseAfterNotVisibleForMs:n,maxMissingHeartbeatIntervalMs:o});return v[t]=l,l}),[m,v,r,n,o,_,p]),S=(0,i.useCallback)((function(){return Object.values(v).filter((function(e){return void 0===e.data&&e.isLoading}))}),[v]),T=(0,i.useMemo)((function(){return{getResource:g,getAllPendingResources:S}}),[g,S]);return i.default.createElement(b.Provider,{value:T},d)}));t.StreamingResourceProvider=v;t.useStreamingResource=function(e){var t=e.url,r=e.streamName,n=(0,i.useContext)(b);if(!n)throw new Error("Attempted to use useStreamingResourceCache without a provider. Please add a provider to your component tree");return n.getResource({url:t,streamName:r})};t.useGetAllPendingStreamingResources=function(){var e,t=(0,i.useContext)(b);return null!==(e=null===t||void 0===t?void 0:t.getAllPendingResources)&&void 0!==e?e:function(){return[]}}},IiRn:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FetchableResource=void 0;var n,i=(n=r("OoM2"))&&n.__esModule?n:{default:n},o=r("QHVe"),a=r("qhgI");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(c){s=!0,i=c}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=u(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function u(e,t){if(e){if("string"===typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _=function(){function e(t){var r=this,n=t.fetch,u=t.url,l=t.cleanupAfterMs,f=t.initialData;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"_subscribers",new Set),d(this,"_noSubscribersTimestamp",Date.now()),d(this,"_onPageVisible",(function(){r._scheduleRefresh()})),d(this,"_stopWatchingPageVisibility",void 0),d(this,"_startWatchingPageVisibility",(function(){if(!r._stopWatchingPageVisibility){var e=(0,o.onVisibleChanged)((function(e){e?r._scheduleRefresh():r._refreshTimeoutId&&clearTimeout(r._refreshTimeoutId)}));r._stopWatchingPageVisibility=e}})),d(this,"_scheduleRefresh",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();if(r._refreshTimeoutId&&clearTimeout(r._refreshTimeoutId),(0,o.getIsVisible)()&&r._subscribers.size){var t,n=void 0,i=c(r._subscribers);try{for(i.s();!(t=i.n()).done;){var a=t.value.maxAgeMs;a&&a>0&&(n=n?Math.min(n,a):a)}}catch(u){i.e(u)}finally{i.f()}var s=n&&r.lastUpdated?r.lastUpdated+n-e:void 0;if("undefined"===typeof s)return;r._refreshTimeoutId=setTimeout(r.fetch,Math.max(s,0))}})),d(this,"_scheduleCleanup",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();if(r._cleanupTimeoutId&&clearTimeout(r._cleanupTimeoutId),r._noSubscribersTimestamp&&r._cleanupAfterMs){var t=r._noSubscribersTimestamp+r._cleanupAfterMs-e;t<=0?(r._data=void 0,r._lastUpdated=void 0,r._notifySubscribers()):r._cleanupTimeoutId=setTimeout((function(){r._data=void 0,r._lastUpdated=void 0,r._notifySubscribers()}),t)}})),d(this,"fetch",(function(){if(r._inFlightRequest)return r._inFlightRequest;return r._inFlightRequest=async function(){var e=await r._fetchFunction(r.url,{headers:{accept:"application/json","content-type":"application/json"}}),t=Date.now();if(r._lastUpdated=t,r._noSubscribersTimestamp=r._noSubscribersTimestamp&&t,r._scheduleCleanup(t),r._scheduleRefresh(t),e instanceof Error)r._data=e,r._notifySubscribers();else{var n=await e.json();(0,i.default)(r._data,n)||(r._data=n,r._notifySubscribers())}r._inFlightRequest=void 0}(),r._inFlightRequest})),d(this,"_notifySubscribers",(function(){var e,t=c(r._subscribers);try{for(t.s();!(e=t.n()).done;){var n=e.value;try{n.callback()}catch(i){(0,a.reportError)({error:i,metadata:{url:r.url}})}}}catch(o){t.e(o)}finally{t.f()}})),d(this,"subscribe",(function(e){return r._subscribers.add(e),r._startWatchingPageVisibility(),r._noSubscribersTimestamp=void 0,r._scheduleRefresh(),r._scheduleCleanup(),function(){var t;(r._subscribers.delete(e),0===r._subscribers.size)&&(r._noSubscribersTimestamp=Date.now(),null===(t=r._stopWatchingPageVisibility)||void 0===t||t.call(r));r._scheduleRefresh(),0===r._subscribers.size&&r._scheduleCleanup()}})),d(this,"clear",(function(){r._data=void 0,r._lastUpdated=void 0,r._notifySubscribers(),r._scheduleRefresh()})),d(this,"optimisticUpdate",(async function(e){var t=s(e(r._data instanceof Error?void 0:r._data),2),n=t[0],i=t[1];return r._data=n,r._lastUpdated=Date.now(),r._notifySubscribers(),await i,await r.fetch(),i})),this.url=u,this._fetchFunction=n,l&&l<0)throw new Error("Cleanup after MS must be greater than 0");this._cleanupAfterMs=l,f&&(this._inFlightRequest=f.then((function(e){r._data=e;var t=Date.now();r._lastUpdated=t,r._noSubscribersTimestamp=r._noSubscribersTimestamp&&t,r._scheduleRefresh(t),r._scheduleCleanup(t),r._inFlightRequest=void 0})))}var t,r,n;return t=e,(r=[{key:"data",get:function(){return this._data}},{key:"lastUpdated",get:function(){return this._lastUpdated}},{key:"numSubscribers",get:function(){return this._subscribers.size}},{key:"isFetching",get:function(){return Boolean(this._inFlightRequest)}}])&&f(t.prototype,r),n&&f(t,n),e}();t.FetchableResource=_},It2l:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyStreamingResource=t.METRIC_NAMES=t.DEFAULT_HEARTBEAT_STALE_TIMEOUT=t.DEFAULT_HEARTBEAT_RECONNECT_TIMEOUT=void 0;var n,i=(n=r("OoM2"))&&n.__esModule?n:{default:n},o=r("F2mt"),a=r("8TRC"),s=r("Jq+A"),c=r("QZlR"),u=r("QHVe"),l=r("qhgI"),f=r("1k3P"),d=r("QNIz"),_=r("l+no");function p(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v=1e3;t.DEFAULT_HEARTBEAT_RECONNECT_TIMEOUT=16e3;t.DEFAULT_HEARTBEAT_STALE_TIMEOUT=2e4;var y={TIME_TO_ESTABLISH_CONNECTION:"sse_time_to_establish_connection",CONNECTION_OPEN:"sse_connection_open",TIME_TO_FIRST_SNAPSHOT:"sse_time_to_first_snapshot",CONTENT_LENGTH:"sse_content_length",CONNECTION_CLOSED:"sse_connection_closed",CONNECTION_ERROR:"sse_connection_error",STALE_DATA:"sse_stale_data"};t.METRIC_NAMES=y;var g=function(){function t(r){var n=this,m=r.url,h=r.streamName,g=r.closeUnusedConnectionAfterMs,S=void 0===g?500:g,T=r.pauseAfterNotVisibleForMs,E=void 0===T?6e4:T,O=r.maxMissingHeartbeatIntervalMs,M=void 0===O?16e3:O,w=r.markAsStaleAfterMs,C=void 0===w?2e4:w,N=r.maxConnectionTimeoutMs,A=void 0===N?1e4:N;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),b(this,"_subscribers",new Set),b(this,"_noSubscribersTimestamp",Date.now()),b(this,"_pageVisible",!0),b(this,"_createdAt",Date.now()),b(this,"_eventSource",void 0),b(this,"_deferredLoad",new _.DeferredPromise),b(this,"_notVisibleTimestamp",(0,u.getIsVisible)()?void 0:Date.now()),b(this,"_eventSourceCreatedTimes",0),b(this,"_currentSnapshot",void 0),b(this,"_maxOpenConnectionTimeout",void 0),b(this,"_missingHeartbeatReconnectTimeout",void 0),b(this,"_missingHeartbeatSetStaleTimeout",void 0),b(this,"_cleanupTimeout",void 0),b(this,"_stopWatchingPageVisibility",void 0),b(this,"_startWatchingPageVisibility",(function(){if(!n._stopWatchingPageVisibility){var e=(0,u.onVisibleChanged)((function(e){var t;e?(n._pageVisible=!0,n._notVisibleTimestamp=void 0,n._open()):(n._pageVisible=!1,n._notVisibleTimestamp=null!==(t=n._notVisibleTimestamp)&&void 0!==t?t:Date.now(),n._subscribers.size&&console.debug(d.CONSOLE_PREFIX,d.CONSOLE_STYLE,"Reopening the SSE connection",n.url),n._scheduleCleanup())}));n._stopWatchingPageVisibility=e}})),b(this,"_handleSnapshotMessage",(function(e){var t=(0,f.apiCamelize)(e);(0,i.default)(n._data,t)||(n._data=t,n._currentSnapshot=void 0,n._notifySubscribers({eventType:"snapshot",data:t})),n._lastUpdated=Date.now(),n._deferredLoad.resolve()})),b(this,"_handlePatchMessage",(function(e){if(e.length)try{var t;if(!n._data)throw new Error("Received a patch without a current snapshot (".concat(n.url,")"));var r,a=p(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;"add"!==s.op&&"replace"!==s.op||(s.value=(0,f.apiCamelize)(s.value)),s.path=(0,f.camelizeJsonPatchPath)(s.path)}}catch(d){a.e(d)}finally{a.f()}(0,o.applyPatch)(n._data,e,!0);var c=n._currentSnapshot instanceof Error||null===(t=n._currentSnapshot)||void 0===t?void 0:t.data,u=n._data instanceof Error?void 0:n._data;n._lastUpdated=Date.now(),(0,i.default)(n._data,c)||(n._currentSnapshot=void 0,n._notifySubscribers({eventType:"patch",data:u,patches:e}))}catch(_){(0,l.reportError)({error:_,metadata:{url:n.url}})}})),b(this,"_handleHeartbeat",(function(){n._lastHeartbeatTimestamp=Date.now()})),b(this,"_handleMessage",(function(){n._lastMessageTimestamp=Date.now(),n._checkMissingHeartbeat(),n._scheduleHeartbeatReconnectCheck()})),b(this,"_handleConnectionOpenMetric",(function(e){var t,r,i,o=n.streamName,a=Date.now()-e,s=null!==(t=null===(r=navigator)||void 0===r||null===(i=r.connection)||void 0===i?void 0:i.effectiveType)&&void 0!==t?t:"undefined";(0,c.logMetric)({metricName:y.TIME_TO_ESTABLISH_CONNECTION,metricType:c.MetricType.distribution,value:a,tags:{stream_name:o}}),(0,c.logMetric)({metricName:y.CONNECTION_OPEN,metricType:c.MetricType.count,value:1,tags:{stream_name:o,connection_type:s}})})),b(this,"_handleFirstSnapshotMetric",(function(e,t){var r=n.streamName;if(n.isAppVisible){var i=Date.now()-t;(0,c.logMetric)({metricName:y.TIME_TO_FIRST_SNAPSHOT,metricType:c.MetricType.distribution,value:i,tags:{stream_name:r}}),(0,c.logMetric)({metricName:y.CONTENT_LENGTH,metricType:c.MetricType.distribution,value:e,tags:{stream_name:r,stream_message_type:"snapshot"}})}})),b(this,"_handleMessageMetric",(function(e,t){var r=Date.now(),i=n._lastSentMetricTimestamp,o=n.streamName;!n.isAppVisible||i&&r-i<1e3||(n._lastSentMetricTimestamp=Date.now(),(0,c.logMetric)({metricName:y.CONTENT_LENGTH,metricType:c.MetricType.distribution,value:t,tags:{stream_name:o,stream_message_type:e}}))})),b(this,"_handleConnectionCloseMetric",(function(e){var t,r,i,o=null!==(t=null===(r=navigator)||void 0===r||null===(i=r.connection)||void 0===i?void 0:i.effectiveType)&&void 0!==t?t:"undefined";(0,c.logMetric)({metricName:y.CONNECTION_CLOSED,metricType:c.MetricType.count,value:1,tags:{stream_name:n.streamName,stream_closing_reason:e,connection_type:o}})})),b(this,"_getIsOnlineMetricValue",(function(){var e=(0,u.getIsOnline)();return void 0===e?"n/a":e?"true":"false"})),b(this,"_handleConnectionErrorMetric",(function(){(0,c.logMetric)({metricName:y.CONNECTION_ERROR,metricType:c.MetricType.count,value:1,tags:{stream_name:n.streamName,is_online:n._getIsOnlineMetricValue()}})})),b(this,"_reconnect",(function(){var e;null===(e=n._eventSource)||void 0===e||e.close(),n._eventSource=void 0,n._open()})),b(this,"_open",(async function(){if(await(0,u.delayUntilNetworkConnection)(),!n._eventSource){n._eventSource=new EventSource(n.url,{withCredentials:!0}),n._eventSourceCreatedTimes+=1;var t=Date.now();n._eventSource.addEventListener("message",(function(e){var r=e.data,i=JSON.parse(r);n._handleMessage(),"snapshot"in i.result?(!n._data&&n.isAppVisible?n._handleFirstSnapshotMetric(r.length,t):n._handleMessageMetric("snapshot",r.length),n._handleSnapshotMessage(i.result.snapshot)):"patch"in i.result?(n._handlePatchMessage(i.result.patch.operations),n._handleMessageMetric("patch",r.length)):i.result.heartbeat&&n._handleHeartbeat()})),n._eventSource.addEventListener("error",(function(){"enabled"===e.env.DETAILED_ERRORS&&(0,l.reportError)({error:new a.ApiError({status:400,headers:new Headers},{message:"Error on streaming resource."}),metadata:{url:n.url}}),n._handleConnectionErrorMetric()}));try{await new Promise((function(e,r){var i,o=function r(){var i;n._maxOpenConnectionTimeout&&clearTimeout(n._maxOpenConnectionTimeout),null===(i=n._eventSource)||void 0===i||i.removeEventListener("open",r),n._handleConnectionOpenMetric(t),n._scheduleIsStaleCheck(),e()};n._maxOpenConnectionTimeout=setTimeout((function(){var e;n._maxOpenConnectionTimeout&&clearTimeout(n._maxOpenConnectionTimeout),null===(e=n._eventSource)||void 0===e||e.removeEventListener("open",o),r({error:new s.NetworkError({message:"Connection timeout reached for url: ".concat(n.url,".")}),metadata:{url:n.url}})}),n._maxConnectionTimeoutMs),null===(i=n._eventSource)||void 0===i||i.addEventListener("open",o)}))}catch(r){(0,l.reportError)(r),n._pageVisible&&n._reconnect()}n._scheduleHeartbeatReconnectCheck(),console.debug(d.CONSOLE_PREFIX,d.CONSOLE_STYLE,"Streaming resource opened.",n.url)}})),b(this,"_scheduleCleanup",(function(){if(n._cleanupTimeout&&clearTimeout(n._cleanupTimeout),n._eventSource){var e=Date.now(),t=n._noSubscribersTimestamp?e-n._noSubscribersTimestamp:void 0,r=n._notVisibleTimestamp?e-n._notVisibleTimestamp:void 0;if("undefined"!==typeof t||"undefined"!==typeof r){var i=Math.min("undefined"!==typeof t?n._closeUnusedConnectionAfterMs-t:Number.MAX_SAFE_INTEGER,"undefined"!==typeof r?n._pauseAfterNotVisibleForMs-r:Number.MAX_SAFE_INTEGER);if(i>0)return console.debug(d.CONSOLE_PREFIX,d.CONSOLE_STYLE,"Streaming connection shutdown scheduled",{url:n.url,shutdownIn:i,reason:"undefined"!==typeof r?"App is not visible":"No active subscribers"}),void(n._cleanupTimeout=setTimeout(n._scheduleCleanup,i+1));"undefined"!==typeof r&&(console.debug(d.CONSOLE_PREFIX,d.CONSOLE_STYLE,"Closing streaming connection because the app is not visible.",{url:n.url}),n._handleConnectionCloseMetric("app_not_visible")),"undefined"!==typeof t&&(console.debug(d.CONSOLE_PREFIX,d.CONSOLE_STYLE,"Closing streaming connection because there are no active subscribers.",{url:n.url}),n._handleConnectionCloseMetric("no_subscribers")),n._eventSource.close(),n._eventSource=void 0,n._missingHeartbeatReconnectTimeout&&clearTimeout(n._missingHeartbeatReconnectTimeout),n._maxOpenConnectionTimeout&&clearTimeout(n._maxOpenConnectionTimeout)}}})),b(this,"_scheduleIsStaleCheck",(function(){n._missingHeartbeatSetStaleTimeout&&clearTimeout(n._missingHeartbeatSetStaleTimeout),n._missingHeartbeatSetStaleTimeout=setTimeout((function(){n._checkMissingHeartbeat()}),n._markAsStaleAfterMs)})),b(this,"_scheduleHeartbeatReconnectCheck",(function(){n._missingHeartbeatReconnectTimeout&&clearTimeout(n._missingHeartbeatReconnectTimeout),n._missingHeartbeatReconnectTimeout=setTimeout((function(){n._pageVisible&&n._reconnect()}),n._maxMissingHeartbeatIntervalMs)})),b(this,"load",(function(){n._open();return async function(){await n._deferredLoad,0===n.numSubscribers&&(n._noSubscribersTimestamp=Date.now(),n._scheduleCleanup())}(),n._deferredLoad})),b(this,"waitForUpdate",(function(){return n._open(),n._updateDeferred||(n._updateDeferred=new _.DeferredPromise),n._updateDeferred})),b(this,"_resolveUpdatePromise",(function(){n._updateDeferred&&(n._updateDeferred.resolve(),n._updateDeferred=void 0)})),b(this,"_eventIsUpdate",(function(e){return"stale"===e.eventType?!e.isStale:"error"!==e.eventType})),b(this,"_notifySubscribers",(function(e){var t,r=p(n._subscribers);try{for(r.s();!(t=r.n()).done;){var i=t.value;try{i.callback(e)}catch(o){(0,l.reportError)({error:o,metadata:{url:n.url}})}}}catch(a){r.e(a)}finally{r.f()}n._eventIsUpdate(e)&&n._resolveUpdatePromise()})),b(this,"_checkMissingHeartbeat",(function(){var e,t=null!==(e=n._lastMessageTimestamp)&&void 0!==e?e:0,r=Date.now(),i=r-t>n._markAsStaleAfterMs,o=n.streamName;i!==n._isStale&&(n._isStale=i,n._isStale?(console.debug(d.CONSOLE_PREFIX,d.CONSOLE_STYLE,o,": Stale data","no heartbeats or other messages seens for",(r-t)/v,"seconds"),n.isAppVisible&&(0,c.logMetric)({metricName:y.STALE_DATA,metricType:c.MetricType.distribution,value:1,tags:{stream_name:o}})):console.debug(d.CONSOLE_PREFIX,d.CONSOLE_STYLE,o,": Stale data recovered"),n._notifySubscribers({eventType:"stale",isStale:i})),n._isStale||n._scheduleIsStaleCheck()})),b(this,"subscribe",(function(e){return n._subscribers.add(e),n._startWatchingPageVisibility(),n._noSubscribersTimestamp=void 0,n._open(),function(){var t;(n._subscribers.delete(e),0===n._subscribers.size)&&(n._noSubscribersTimestamp=Date.now(),null===(t=n._stopWatchingPageVisibility)||void 0===t||t.call(n));0===n.numSubscribers&&(n._noSubscribersTimestamp=Date.now(),n._scheduleCleanup())}})),this.url=m,this.streamName=h,S&&S<0)throw new Error("closeUnusedConnectionAfter after MS must be greater than 0");if(E&&E<0)throw new Error("pauseAfterNotVisibleForMs must be greater than 0");this._createdAt=Date.now(),this._maxMissingHeartbeatIntervalMs=M,this._closeUnusedConnectionAfterMs=S,this._pauseAfterNotVisibleForMs=E,this._markAsStaleAfterMs=C,this._maxConnectionTimeoutMs=A,this._isStale=!1}var r,n,m;return r=t,(n=[{key:"data",get:function(){return this._data}},{key:"lastUpdated",get:function(){return this._lastUpdated}},{key:"numSubscribers",get:function(){return this._subscribers.size}},{key:"dataSnapshot",get:function(){var e=this._data,t=this._lastUpdated;if(e)return this._currentSnapshot||(this._currentSnapshot=e instanceof Error?e:{data:(0,o.deepClone)(e),lastUpdated:null!==t&&void 0!==t?t:Date.now()}),this._currentSnapshot}},{key:"lastHeartbeatTimestamp",get:function(){return this._lastHeartbeatTimestamp}},{key:"isLoading",get:function(){return(!this.data||this._isStale)&&Boolean(this._eventSource)}},{key:"isAppVisible",get:function(){return"undefined"===typeof this._notVisibleTimestamp}}])&&h(r.prototype,n),m&&h(r,m),t}();t.LegacyStreamingResource=g}).call(this,r("5IsQ"))},"Jq+A":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NetworkError",{enumerable:!0,get:function(){return n.NetworkError}});var n=r("5McB")},Q0yx:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiCamelizeMiddleware=void 0;var n=r("5McB"),i=r("1k3P");t.apiCamelizeMiddleware=function(e){return async function(t,r){var o=await e(t,r);if(o instanceof n.NetworkError)return o;if(o instanceof n.ApiError)return o.responseJson=(0,i.apiCamelize)(o.responseJson),o;var a=o.json.bind(o);return o.json=async function(){try{var e=await a.apply(void 0,arguments);return null!==r&&void 0!==r&&r.disableCamelize?e:(0,i.apiCamelize)(e)}catch(t){return t}},o}}},QHVe:function(e,t,r){"use strict";var n,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.resetVisibilityApi=t.setVisibilityApi=t.onVisibleChanged=t.getIsVisible=t.__testOnlyClearIsOnline=t.delayUntilNetworkConnection=t.setIsOnline=t.getIsOnline=void 0;t.getIsOnline=function(){return n};t.setIsOnline=function(e){n=e,!0===e&&o&&(o(),i=void 0,o=void 0)};t.delayUntilNetworkConnection=function(){return void 0===n||!0===n?Promise.resolve():(void 0===i&&(i=new Promise((function(e){o=e}))),i)};t.__testOnlyClearIsOnline=function(){n=void 0};var a=function(){return!0},s=function(){return function(){}};t.getIsVisible=function(){return a()};t.onVisibleChanged=function(e){return s(e)};t.setVisibilityApi=function(e){var t=e.getIsVisible,r=e.onVisibleChanged;a=t,s=r};t.resetVisibilityApi=function(){a=function(){return!0},s=function(){return function(){}}}},QNIz:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONSOLE_STYLE=t.CONSOLE_PREFIX=void 0;t.CONSOLE_PREFIX="%c Instant API Hooks:";t.CONSOLE_STYLE="color:blue"},QZlR:function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.logMetric=t.setupMetricHandler=t.MetricType=void 0,t.MetricType=n,function(e){e.count="count",e.rate="rate",e.gauge="gauge",e.distribution="distribution",e.histogram="histogram"}(n||(t.MetricType=n={}));t.setupMetricHandler=function(e){i=e};t.logMetric=function(e){if(i){var t;try{"undefined"!==typeof window&&(t=window.requestIdleCallback.bind(window))}catch(r){}t?t(i.bind(null,e)):i(e)}}},jQet:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setBaseUrl=t.getBaseUrl=void 0;let n="";t.setBaseUrl=e=>n=e;t.getBaseUrl=()=>n},"l+no":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeferredPromise=void 0;t.DeferredPromise=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._promise=new Promise((function(e,r){t.resolve=e,t.reject=r})),this.then=this._promise.then.bind(this._promise),this.catch=this._promise.catch.bind(this._promise),this.finally=this._promise.finally.bind(this._promise),this[Symbol.toStringTag]="DeferredPromise"}},qhgI:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reportError=t.setErrorHandler=t.createErrorReporter=t.shouldReport=t.consoleNotify=t.CONSOLE_STYLE=t.CONSOLE_PREFIX=void 0;var n,i=(n=r("w1Rh"))&&n.__esModule?n:{default:n};function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){return c="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}var u={info:console.info,warning:console.warn,error:console.error},l="%c Error Reporting:";t.CONSOLE_PREFIX=l;var f="color:red;";t.CONSOLE_STYLE=f;var d=function(e){var t=e.severity;(u[t||"error"]||console.error)(l,f,e)};t.consoleNotify=d;var _=function(e){return!("reportError"in e)||!1!==e.reportError};t.shouldReport=_;var p=function(e){return function(t){var r;t instanceof Error?(r={error:t},console.warn(l,f,"reportError called incorrectly (reportError(error) rather than reportError({error}))")):"object"===c(t)?(r=t).error instanceof Error||(console.warn(l,f,"reportError called incorrectly with something other than an error object",t),r.metadata=a(a({},r.metadata),{},{originalErrorData:JSON.stringify(r.error)}),r.error=new Error("Unspecified error.")):(r={error:new Error("Unspecified error."),metadata:{originalErrorData:JSON.stringify(t)}},console.warn(l,f,"reportError called incorrectly"));var n=r.error,o=function(e){return(0,i.default)(e.message+e.stack).substring(0,8)}(n);return _(n)&&e(r,o),{errorHash:o}}};t.createErrorReporter=p;var m=p(d);t.setErrorHandler=function(e){m=e};t.reportError=function(e){try{return m(e)}catch(t){return console.error(l,f,"Error reporting error",t),{}}}}}]);
//# sourceMappingURL=instantapihooks-d6283050147b9c779d28.chunk.js.map